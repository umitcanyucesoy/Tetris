using System.Collections;using System.Collections.Generic;using UnityEngine;using UnityEngine.EventSystems;using UnityEngine.UI;namespace Game.Scripts.Game.Managers{    public class InputManager : MonoSingleton<InputManager>    {        private float _nextHorizTime = 0f;                public IEnumerator PlayerInput(float cellX, float dropInterval, float fastDropInterval,        float deadzonePixels, float horizStepInterval)        {            const float tapMaxTime     = .2f;            const float flickMaxTime   = .18f;            const float flickMinPixels = 80f;            float dragStepPixels = Mathf.Max(deadzonePixels * 2f, 28f);            while (true)            {                while (!Input.GetMouseButtonDown(0))                    yield return null;                                if (ClickBeganOnUIButton())                {                    while (Input.GetMouseButton(0)) yield return null;                    continue;                }                Vector3 startPos    = Input.mousePosition;                Vector3 prevPos     = startPos;                float   startTime   = Time.time;                bool    didDrag     = false;                float accumX = 0f;                while (Input.GetMouseButton(0))                {                    Vector3 curr = Input.mousePosition;                    Vector3 frameDelta = curr - prevPos;                       prevPos = curr;                    accumX += frameDelta.x;                    if (Mathf.Abs(accumX) > Mathf.Abs(frameDelta.y) && Mathf.Abs(accumX) >= dragStepPixels)                    {                        int steps = Mathf.FloorToInt(Mathf.Abs(accumX) / dragStepPixels);                         int dir   = accumX > 0f ? +1 : -1;                        for (int s = 0; s < steps; s++)                            GameManager.Instance.currentShape.MoveHorizontal(dir * cellX);                        accumX -= dir * steps * dragStepPixels;                        didDrag = true;                    }                    float totalDown = (curr.y - startPos.y);                    if (totalDown <= -deadzonePixels)                    {                        GameManager.Instance.SetDropInterval(fastDropInterval);                        didDrag = true;                    }                    else                    {                        GameManager.Instance.SetDropInterval(dropInterval);                    }                    yield return null;                }                GameManager.Instance.SetDropInterval(dropInterval);                float   heldTime   = Time.time - startTime;                Vector3 totalDelta = (Input.mousePosition - startPos);                if (heldTime <= flickMaxTime && totalDelta.y <= -flickMinPixels)                {                    GameManager.Instance.HardDrop();                    yield return null;                    continue;                }                if (!didDrag && heldTime <= tapMaxTime && totalDelta.magnitude <= deadzonePixels)                {                    GameManager.Instance.currentShape.MoveRotate();                }                yield return null;            }        }        public IEnumerator PlayerKeyboard(float cellX, float dropInterval, float fastDropInterval,            float horizStepInterval)        {            while (true)            {                int dir = 0;                if (Input.GetKey(KeyCode.LeftArrow)) dir = -1;                if (Input.GetKey(KeyCode.RightArrow)) dir = +1;                                if (Input.GetKeyDown(KeyCode.LeftArrow) || Input.GetKeyDown(KeyCode.RightArrow))                {                    GameManager.Instance.currentShape.MoveHorizontal(dir * cellX);                    _nextHorizTime = Time.time + horizStepInterval;                  }                                if (dir != 0 && Time.time >= _nextHorizTime)                {                    GameManager.Instance.currentShape.MoveHorizontal(dir * cellX);                    _nextHorizTime = Time.time + horizStepInterval;                }                                if (dir == 0)                    _nextHorizTime = 0f;                                if (Input.GetKeyDown(KeyCode.Space))                    GameManager.Instance.currentShape.MoveRotate();                if (Input.GetKeyDown(KeyCode.UpArrow))                {                    GameManager.Instance.HardDrop();                    yield return null;                    continue;                }                                if (Input.GetKeyDown(KeyCode.V))                {                    GameManager.Instance.HoldSwap();                    yield return null;                    continue;                }                                if (Input.GetKey(KeyCode.DownArrow))                    GameManager.Instance.SetDropInterval(fastDropInterval);                else if (!Input.GetMouseButton(0))                    GameManager.Instance.SetDropInterval(dropInterval);                                yield return null;            }        }                private bool ClickBeganOnUIButton()        {            if (!EventSystem.current) return false;            Vector2 pos = Input.mousePosition;            var data = new PointerEventData(EventSystem.current) { position = pos };            var hits = new List<RaycastResult>();            EventSystem.current.RaycastAll(data, hits);            foreach (var hit in hits)            {                if (hit.gameObject.TryGetComponent<Button>(out var btn)                    && btn.IsActive() && btn.interactable)                    return true;             }            return false;        }    }}